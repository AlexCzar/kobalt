buildscript {
    ext.kotlin_version = '0.14.449'

    repositories {
        mavenCentral()
        jcenter()
        maven {
            url 'http://oss.sonatype.org/content/repositories/snapshots'
        }
    }
    dependencies {
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:${kotlin_version}"
        classpath "org.jetbrains.kotlin:kotlin-stdlib:${kotlin_version}"
    }
}

plugins {
    id "com.jfrog.bintray" version "1.2"
}

version = '0.121'

//apply plugin: 'java'
apply plugin: 'kotlin'
//apply plugin: 'application'
apply plugin: 'com.jfrog.bintray'

apply from: 'gradle/publishing.gradle'

repositories {
    mavenCentral()
    jcenter()
    maven {
        url 'http://oss.sonatype.org/content/repositories/snapshots'
    }
}

dependencies {
    compile "org.jetbrains.kotlin:kotlin-stdlib:${kotlin_version}",
            "org.jetbrains.kotlin:kotlin-compiler-embeddable:${kotlin_version}",
//            "org.jetbrains.kotlin:kotlin-compiler:${kotlin_version}",

            'com.beust:jcommander:1.48',
            'com.beust:klaxon:0.16',
            'com.squareup.okhttp:okhttp:2.4.0',
            'org.slf4j:slf4j-api:1.7.12',
            'org.slf4j:slf4j-simple:1.7.12',
            'ch.qos.logback:logback-classic:1.1.2',
            'org.jsoup:jsoup:1.8.2',
            'com.google.inject:guice:4.0',
            'com.google.inject.extensions:guice-assistedinject:4.0',
            'com.google.guava:guava:18.0',
            'org.apache.maven:maven-model:3.3.3',
            'com.github.spullara.mustache.java:compiler:0.8.18'

//    compile files("/Users/beust/.kobalt/repository/com/beust/kobalt-example-plugin/build/libs/kobalt-example-plugin.jar")
    testCompile 'org.testng:testng:6.9.6'
    compile "org.jetbrains.kotlin:kotlin-stdlib:$kotlin_version"
//    testCompile 'junit:junit:4.12'
}

task sourceJar(type: Jar) {
    group 'Build'
    description 'An archive of the source code'
    classifier 'sources'
    from sourceSets.main.allSource
}

artifacts {
    file('build/libs/kobalt.jar')
    sourceJar
}
sourceSets {
    main.java.srcDirs += 'src/main/kotlin'
    test.java.srcDirs += 'src/test/kotlin'
}

test {
    useTestNG()
    beforeTest { descriptor ->
        logger.lifecycle("    Running test: " + descriptor)
    }
}

compileKotlin {
    kotlinOptions.suppressWarnings = true
}

apply plugin: 'application'
mainClassName = 'com.beust.kobalt.KobaltPackage'

jar {
    manifest {
        attributes "Main-Class": "$mainClassName"
    }

    from {
        configurations.compile.collect { it.isDirectory() ? it : zipTree(it) }
    }
}

